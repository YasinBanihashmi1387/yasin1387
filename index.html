<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پلتفرم تحلیل بازار ارز دیجیتال</title>
    <style>
        /* تنظیمات پایه */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Iran Sans', Tahoma, sans-serif;
        }
        
        body {
            background-color: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        /* هدر سایت */
        header {
            background: linear-gradient(135deg, #1e3a8a, #2563eb);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        /* محتوای اصلی */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        /* بخش اخبار و اعلانات */
        .news-section {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .news-section h2 {
            color: #1e40af;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }
        
        /* بخش چارت و سایدبار */
        .content-wrapper {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        /* استایل چارت */
        .chart-wrapper {
            flex: 3;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .chart-header {
            padding: 1rem;
            background: #f1f5f9;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .chart-tabs {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }
        
        .chart-tabs::-webkit-scrollbar {
            height: 5px;
        }
        
        .chart-tabs::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .tab-btn {
            padding: 0.5rem 1rem;
            background: #e2e8f0;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: #cbd5e1;
        }
        
        .tab-btn.active {
            background: #1e40af;
            color: white;
        }
        
        #tradingview_chart {
            width: 100%;
            height: 500px;
        }
        
        /* سایدبار */
        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-width: 300px;
        }
        
        .widget {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .widget h3 {
            color: #1e40af;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }
        
        /* لیست نمادها */
        .symbol-list {
            list-style: none;
        }
        
        .symbol-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .symbol-list li:last-child {
            border-bottom: none;
        }
        
        .price-up {
            color: #10b981;
            transition: color 0.3s ease;
        }
        
        .price-up::after {
            content: " ↑";
        }
        
        .price-down {
            color: #ef4444;
            transition: color 0.3s ease;
        }
        
        .price-down::after {
            content: " ↓";
        }
        
        .skeleton-loader {
            display: inline-block;
            width: 100px;
            height: 20px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* فوتر */
        footer {
            background: #1e293b;
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        /* واکنشگرایی */
        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            #tradingview_chart {
                height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }
            
            .sidebar {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- هدر سایت -->
    <header>
        <h1>پلتفرم تحلیل بازار ارز دیجیتال</h1>
        <p>ابزارهای حرفه‌ای برای معامله‌گران</p>
    </header>
    
    <!-- محتوای اصلی -->
    <div class="main-container">
        <!-- بخش اخبار -->
        <section class="news-section">
            <h2>آخرین اخبار بازار</h2>
            <p id="live-news">قیمت بیت‌کوین در 24 ساعت گذشته با رشد 2.5% همراه بوده است. تحلیلگران پیش‌بینی می‌کنند این روند صعودی در روزهای آینده ادامه خواهد داشت.</p>
        </section>
        
        <!-- بخش چارت و سایدبار -->
        <div class="content-wrapper">
            <!-- بخش چارت -->
            <div class="chart-wrapper">
                <div class="chart-header">
                    <div class="chart-tabs">
                        <button class="tab-btn active" data-symbol="BINANCE:BTCUSDT">BTC/USDT</button>
                        <button class="tab-btn" data-symbol="BINANCE:ETHUSDT">ETH/USDT</button>
                        <button class="tab-btn" data-symbol="BINANCE:ADAUSDT">ADA/USDT</button>
                        <button class="tab-btn" data-symbol="BINANCE:SOLUSDT">SOL/USDT</button>
                        <button class="tab-btn" data-symbol="BINANCE:DOTUSDT">DOT/USDT</button>
                    </div>
                </div>
                <div id="tradingview_chart"></div>
            </div>
            
            <!-- سایدبار -->
            <div class="sidebar">
                <!-- لیست نمادها -->
                <div class="widget">
                    <h3>نمادهای پرتراکنش</h3>
                    <ul class="symbol-list">
                        <li>
                            <span>BTC/USDT</span>
                            <span class="skeleton-loader" id="BTC-price"></span>
                        </li>
                        <li>
                            <span>ETH/USDT</span>
                            <span class="skeleton-loader" id="ETH-price"></span>
                        </li>
                        <li>
                            <span>ADA/USDT</span>
                            <span class="skeleton-loader" id="ADA-price"></span>
                        </li>
                        <li>
                            <span>SOL/USDT</span>
                            <span class="skeleton-loader" id="SOL-price"></span>
                        </li>
                        <li>
                            <span>DOT/USDT</span>
                            <span class="skeleton-loader" id="DOT-price"></span>
                        </li>
                    </ul>
                </div>
                
                <!-- تحلیل تکنیکال -->
                <div class="widget">
                    <h3>تحلیل امروز</h3>
                    <p id="technical-analysis">شاخص RSI بیت‌کوین در محدوده 58 قرار دارد که نشان‌دهنده شرایط خنثی تا کمی صعودی است. مقاومت اصلی در $43,200 و حمایت در $41,800 قرار دارد.</p>
                </div>
                
                <!-- ابزارها -->
                <div class="widget">
                    <h3>ابزارهای تحلیل</h3>
                    <button class="tab-btn" style="width: 100%; margin-bottom: 0.5rem;">ماشین حساب سود</button>
                    <button class="tab-btn" style="width: 100%;" id="price-alert-btn">هشدار قیمتی</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- فوتر -->
    <footer>
        <p>© <span id="current-year"></span> پلتفرم تحلیل بازار ارز دیجیتال. تمام حقوق محفوظ است.</p>
    </footer>

    <!-- اسکریپت TradingView -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
        // تنظیم سال جاری در فوتر
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // ایجاد ویجت TradingView
        let tradingViewWidget = null;
        
        function initTradingView(symbol = "BINANCE:BTCUSDT") {
            if (tradingViewWidget) {
                tradingViewWidget.remove();
            }
            
            tradingViewWidget = new TradingView.widget({
                "autosize": true,
                "symbol": symbol,
                "interval": "1D",
                "timezone": "Asia/Tehran",
                "theme": "light",
                "style": "1",
                "locale": "fa_IR",
                "toolbar_bg": "#f1f5f9",
                "enable_publishing": false,
                "hide_top_toolbar": false,
                "allow_symbol_change": false,
                "container_id": "tradingview_chart",
                "studies": ["RSI@tv-basicstudies"],
                "overrides": {
                    "mainSeriesProperties.style": 1,
                    "mainSeriesProperties.candleStyle.upColor": "#10b981",
                    "mainSeriesProperties.candleStyle.downColor": "#ef4444",
                    "paneProperties.background": "#ffffff",
                    "paneProperties.vertGridProperties.color": "#f1f5f9",
                    "paneProperties.horzGridProperties.color": "#f1f5f9",
                    "mainSeriesProperties.showCountdown": false,
                    "paneProperties.vertGridProperties.style": 0
                }
            });
        }
        
        // راه‌اندازی اولیه چارت
        initTradingView();
        
        // تغییر نماد با کلیک روی تب‌ها
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                initTradingView(this.dataset.symbol);
            });
        });
        
        // مدیریت قیمت‌ها
        const symbols = {
            'BTC': 'BTCUSDT',
            'ETH': 'ETHUSDT',
            'ADA': 'ADAUSDT',
            'SOL': 'SOLUSDT',
            'DOT': 'DOTUSDT'
        };
        
        const lastPrices = {
            BTC: 0,
            ETH: 0,
            ADA: 0,
            SOL: 0,
            DOT: 0
        };
        
        // تابع به‌روزرسانی قیمت‌ها
        function updatePrices(data) {
            requestAnimationFrame(() => {
                data.forEach(item => {
                    for (const [key, value] of Object.entries(symbols)) {
                        if (item.s === value || item.symbol === value) {
                            const currentPrice = parseFloat(item.c || item.lastPrice);
                            const priceChange = parseFloat(item.P || item.priceChangePercent).toFixed(2);
                            
                            // فقط اگر تغییر قابل توجه بود UI را به‌روز کن
                            if (Math.abs(currentPrice - lastPrices[key]) > 0.1 || 
                                document.getElementById(`${key}-price`).classList.contains('skeleton-loader')) {
                                
                                lastPrices[key] = currentPrice;
                                const priceElement = document.getElementById(`${key}-price`);
                                
                                // حذف اسکلت لودر
                                if (priceElement.classList.contains('skeleton-loader')) {
                                    priceElement.classList.remove('skeleton-loader');
                                }
                                
                                priceElement.textContent = `$${currentPrice.toLocaleString('en')} (${priceChange}%)`;
                                priceElement.className = priceChange >= 0 ? 'price-up' : 'price-down';
                            }
                        }
                    }
                });
            });
        }
        
        // WebSocket برای داده‌های لحظه‌ای
        let ws = null;
        let wsRetryCount = 0;
        const maxRetries = 3;
        
        function setupWebSocket() {
            const symbolStreams = Object.values(symbols).map(s => `${s.toLowerCase()}@ticker`).join('/');
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbolStreams}`);
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (Array.isArray(data)) {
                    updatePrices(data);
                } else {
                    updatePrices([data]);
                }
            };
            
            ws.onerror = (error) => {
                console.error('خطای WebSocket:', error);
                if (wsRetryCount < maxRetries) {
                    setTimeout(setupWebSocket, 1000 * Math.pow(2, wsRetryCount));
                    wsRetryCount++;
                } else {
                    console.log('استفاده از API معمولی به عنوان Fallback');
                    fetchPrices();
                    setInterval(fetchPrices, 10000);
                }
            };
            
            ws.onclose = () => {
                if (wsRetryCount < maxRetries) {
                    setTimeout(setupWebSocket, 1000 * Math.pow(2, wsRetryCount));
                    wsRetryCount++;
                }
            };
        }
        
        // API Fallback
        async function fetchPrices() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/24hr');
                const data = await response.json();
                updatePrices(data);
            } catch (error) {
                console.error('خطا در دریافت قیمت‌ها:', error);
            }
        }
        
        // راه‌اندازی اولیه
        setupWebSocket();
        
        // دکمه هشدار قیمتی
        document.getElementById('price-alert-btn').addEventListener('click', function() {
            alert('سیستم هشدار قیمتی به زودی فعال خواهد شد!');
        });
    </script>
</body>
</html>